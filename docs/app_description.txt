# MangaTranslator - Приложение для перевода манги

## Общее описание
MangaTranslator - это приложение для macOS, которое позволяет переводить мангу с японского/корейского языка на русский или другие языки. Приложение использует технологии компьютерного зрения для распознавания текста, нейронные сети для перевода и продвинутые алгоритмы обработки изображений.

## Основные компоненты

### 1. Пользовательский интерфейс (UI)
- Главное окно с двумя колонками:
  - Левая колонка: список загруженных страниц
  - Правая колонка: предпросмотр выбранной страницы
- Кнопки управления:
  - Добавить страницы
  - Обработать страницы
  - Экспортировать результат
- Индикаторы прогресса для каждой операции

### 2. Обработка изображений (ImageProcessingService)

#### 2.1 Распознавание текста
1. Предварительная обработка изображения:
   - Увеличение контраста (коэффициент 1.1)
   - Повышение резкости (radius: 1.0, intensity: 0.5)
   - Удаление насыщенности для лучшего распознавания

2. Распознавание текста с помощью Vision Framework:
   - Поддержка японского и корейского языков
   - Минимальная высота текста: 1% от высоты изображения
   - Словарь частых японских частиц для улучшения распознавания
   - Объединение близких текстовых регионов для лучшего результата

#### 2.2 Перевод текста
1. Использование OpenAI API для перевода:
   - Поддержка пакетного перевода
   - Сохранение контекста и стиля оригинала
   - Обработка специфических терминов манги

#### 2.3 Закрашивание оригинального текста
1. Анализ области текста:
   - Определение границ текста
   - Создание маски для области текста
2. Заливка области:
   - Использование белого цвета для базовой заливки
   - Сохранение окружающих деталей изображения

#### 2.4 Наложение переведенного текста
1. Анализ фона:
   - Определение яркости фона вокруг текста
   - Выбор цвета текста (черный/белый) в зависимости от фона

2. Отрисовка текста:
   - Адаптивный размер шрифта (0.8 от высоты области или 0.2 от ширины)
   - Позиционирование:
     * Вертикальный отступ: 1.5 высоты области или минимум 50 пикселей
     * Горизонтальный отступ: 30% ширины области
   - Максимальная область текста:
     * Ширина: 2.0 от оригинальной области
     * Высота: 1.5 от оригинальной области
   - Обводка текста для лучшей читаемости

### 3. Экспорт результатов
1. Выбор директории для сохранения
2. Сохранение обработанных страниц в формате PNG
3. Автоматическая нумерация файлов

## Технические особенности

### Используемые технологии:
- SwiftUI для интерфейса
- Vision Framework для распознавания текста
- Core Graphics для обработки изображений
- OpenAI API для перевода
- Асинхронное программирование для плавной работы

### Безопасность:
- API ключи хранятся в .env файле
- Безопасная обработка изображений через ImageWrapper
- Обработка ошибок на всех этапах

### Оптимизация:
- Эффективное использование памяти
- Кэширование промежуточных результатов
- Параллельная обработка где возможно

## Процесс обработки страницы

1. Загрузка изображения:
   - Проверка формата
   - Создание ImageWrapper
   - Добавление в список страниц

2. Распознавание текста:
   - Предобработка изображения
   - Поиск текстовых регионов
   - Объединение близких регионов

3. Перевод:
   - Отправка текста на перевод
   - Получение переведенного текста
   - Сохранение перевода в регионах

4. Обработка изображения:
   - Закрашивание оригинального текста
   - Анализ фона для каждого региона
   - Наложение переведенного текста

5. Сохранение результата:
   - Создание финального изображения
   - Сохранение в выбранную директорию 